<link rel="import" href="../polymer/polymer.html">

<script>

    /**
     * @polymerBehavior
     */
    Polymer.AirPaginatorBehavior = {
        properties: {
            // User Input
            /**
             * The Index of the first Items to display In the List
             */
            from: {
                type: Number,
                notify: true,
                value: 0
            },
            /**
             * The Number of the Items to display In the List
             */
            size: {
                type: Number,
                notify: true,
                value: 10
            },
            /**
             * The range of Page to display In the Paginator
             */
            range: {
                type: Number,
                notify: true,
                value: 10
            },
            /**
             * Number of Items In the List
             */
            total: {
                type: Number,
                notify: true
            },
            // Status Value
            firstPage: {
                type: Number,
                notify: true,
                value: 1
            },
            lastPage: {
                type: Number,
                notify: true,
                computed: '_computeLastPage(total, size)'
            },
            currentPage: {
                type: Number,
                notify: true,
                value: 1
            },
            currentRange: {
                type: Array,
                notify: true,
                computed: '_computePageRange(range, firstPage, currentPage, lastPage)'
            }
        },


        observers: [
            '_computeCurrentPage(from, size)'
        ],

        // --- Apis
        // --- ---------------------
        handleSelectPage: function(event) {
            var evt = Polymer.dom(event);
            // console.dir(event);
            // console.dir(evt);
            var sender =  evt.rootTarget;
            var pageid = sender.getAttribute('pageid');
            this.selectPage(pageid);
        },

        selectPage: function (pageid) {
             console.log("select Page : ", pageid);
            // verb control
            switch (pageid) {
                case 'next' :
                    pageid = '+1';
                    break;
                case 'previous' :
                    pageid = '-1';
                    break;
                case 'nextRange' :
                    pageid = '+' + this.range;
                    break;
                case 'previousRange' :
                    pageid = '-' + this.range;
                    break;
                case 'first' :
                    pageid = this.firstPage;
                    break;
                case 'last' :
                    pageid = this.lastPage;
                    break;
            }
            var nextCurrent = this.currentPage;
            // Do operation
            if ((typeof pageid === 'string') && (pageid.indexOf('+') === 0)) {
                var inc1 = parseInt(pageid.slice(1), 10);
                //console.log('Select  page + ', inc, ' current ', this.currentPage, ' /this.lastPage , ', this.lastPage);
                nextCurrent = Math.min(this.lastPage, this.currentPage + inc1);
                //console.log('Select  page + ', inc, ' current ', this.currentPage);
            } else if ((typeof pageid === 'string') && (pageid.indexOf('-') === 0)) {
                var inc2 = parseInt(pageid.slice(1), 10);
                nextCurrent = Math.max(this.firstPage, this.currentPage - inc2);
            } else {
                nextCurrent = Math.min(Math.max(parseInt(pageid, 10), this.firstPage), this.lastPage);
            }
            console.log("select Page : ", pageid, ' ---- > currentPage = ', nextCurrent);
            this.currentPage = nextCurrent;
        },


        // --- Event
        // --- ---------------------
        firePagingChangeEvent: function () {
            this.fire('change', {
                'from': this.from,
                'size': this.size
            });
        },

        // --- User Input Event
        // --- ---------------------
        _computeCurrentPage: function (from, size) {
            var nextCurrent = size > 0 ? Math.max(1, Math.floor(from / size) + 1) : 0;
            //  console.log('compute current page :', nextCurrent);
            console.log('--- _computeCurrentPage (', from, ', ', size, ') ---> ', nextCurrent);
            this.currentPage = nextCurrent;
        },

        // --- Computed Logic
        // --- ---------------------
        _computePageRange: function (range, firstpage, currentpage, lastpage) {
            console.log('--- _computePageRange (', range, ', ', firstpage, ', ', currentpage, ', ', lastpage, ') ---> ');

            var paginations = [];
            // Check currentPage in range
//            if (currentPage > lastPage) {
//                this.currentPage = Math.max(firstPage, lastPage);
//                return paginations;
//            }
            // Rangeoo
            var rangeMin, rangeMax;
            if (this.range === -1) {
                // Display all pages
                rangeMin = firstpage;
                rangeMax = lastpage;
            } else {
                // Display a range of pages
                var rangeMiddle = Math.ceil(range / 2) - 1;
                rangeMin = Math.max(1, currentpage - rangeMiddle);
                rangeMax = Math.min(lastpage, rangeMin + range - 1);
            }
            // Compute range in case of reach end
            if (rangeMax - rangeMin < range) {
                rangeMin = Math.max(1, rangeMax - range + 1);
            }
            for (var i = rangeMin; i <= rangeMax; i++) {
                paginations.push(i);
            }
            return paginations;
        },

        _computeLastPage: function (total, size) {
            // return Math.ceil(this.total / this.size);
            var newLastPage = size > 0 ? Math.max(1, Math.ceil(total / size)) : 0;
            console.log('--- _computeLastPage (', total, ', ', size, ') ---> ', newLastPage);
            return newLastPage;
        },


    };
</script>
